<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Realtime Network Monitor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />

    <link rel="stylesheet" href="{{ url_for('static', filename='css/custom.css') }}" />
  </head>
  <body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark mb-4">
      <div class="container">
        <a class="navbar-brand" href="#"><i class="bi bi-hdd-network"></i> AIOps Network Monitor</a>
        <div class="d-flex align-items-center">
          <span class="live-indicator" id="liveIndicator"></span>
          <span class="text-white small" id="statusText">Ready</span>
        </div>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"><span class="navbar-toggler-icon"></span></button>

        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto align-items-center">
            <li class="nav-item me-3 text-white">
              <i class="bi bi-person-circle"></i> Halo, <b>{{ session.username }}</b>
            </li>
            <li class="nav-item">
              <a href="{{ url_for('logout') }}" class="btn btn-outline-danger btn-sm"><i class="bi bi-box-arrow-right"></i> Logout</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>

    <div class="container mt-4">
      <div class="row mb-4 align-items-center">
        <div class="col-md-8">
          <div class="row">
            <div class="col-md-4 mb-2">
              <div class="card-counter border-left-primary">
                <i class="bi bi-hdd-network"></i>
                <span class="count-numbers" id="total-count">{{ hosts|length }}</span>
                <span class="count-name">Total Devices</span>
              </div>
            </div>
            <div class="col-md-4 mb-2">
              <div class="card-counter border-left-success">
                <i class="bi bi-check-circle"></i>
                <span class="count-numbers text-success" id="online-count">0</span>
                <span class="count-name">Online</span>
              </div>
            </div>
            <div class="col-md-4 mb-2">
              <div class="card-counter border-left-danger">
                <i class="bi bi-x-circle"></i>
                <span class="count-numbers text-danger" id="offline-count">0</span>
                <span class="count-name">Offline</span>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-4">
          <div class="card border-0 shadow-sm">
            <div class="card-body bg-light rounded">
              <h6 class="text-muted mb-3"><i class="bi bi-clock-history"></i> Pengaturan Realtime</h6>
              <div class="form-check form-switch mb-2">
                <input class="form-check-input" type="checkbox" id="autoRefreshSwitch" />
                <label class="form-check-label fw-bold" for="autoRefreshSwitch">Live Mode (Auto Refresh)</label>
              </div>
              <div class="input-group input-group-sm">
                <span class="input-group-text">Interval</span>
                <select class="form-select" id="refreshInterval">
                  <option value="5000">5 Detik</option>
                  <option value="10000" selected>10 Detik</option>
                  <option value="30000">30 Detik</option>
                  <option value="60000">1 Menit</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="card shadow-sm border-0">
        <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
          <h5 class="mb-0 text-secondary"><i class="bi bi-list-task"></i> Monitoring List</h5>
          <div class="">
            <button class="btn btn-success btn-sm m-1" data-bs-toggle="modal" data-bs-target="#addModal"><i class="bi bi-plus-lg"></i> Tambah</button>
            <button onclick="manualCheck()" id="btnManualRefresh" class="btn btn-primary btn-sm m-1"><i class="bi bi-arrow-clockwise"></i> Refresh</button>
            <button class="btn btn-secondary btn-sm m-1" onclick="openHistory()"><i class="bi bi-journal-text"></i> Log History</button>
            <button class="btn btn-primary btn-sm m-1" onclick="openChat()"><i class="bi bi-chat-dots-fill"></i> Chat AI Assistant</button>
          </div>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
              <thead class="table-light">
                <tr>
                  <th class="ps-4">Device Name</th>
                  <th>IP Address</th>
                  <th>Last Checked</th>
                  <th class="text-center">Status</th>
                  <th class="text-center">Aksi</th>
                </tr>
              </thead>
              <tbody>
                {% for host in hosts %}
                  <tr class="host-row" data-id="{{ host.id }}" data-ip="{{ host.ip_address }}">
                    <td class="ps-4 fw-bold text-dark">{{ host.name }}</td>
                    <td class="font-monospace text-muted">{{ host.ip_address }}</td>
                    <td class="small text-muted last-checked-cell">{{ host.last_checked }}</td>
                    <td class="text-center status-cell">
                      <span class="badge bg-secondary rounded-pill">WAITING...</span>
                    </td>
                    <td class="text-center">
                      <button class="btn btn-sm btn-link text-warning" onclick="openEditModal('{{ host.id }}', '{{ host.name }}', '{{ host.ip_address }}')"><i class="bi bi-pencil-square"></i></button>
                      <button class="btn btn-sm btn-link text-danger" onclick="openDeleteModal('{{ host.id }}', '{{ host.name }}')"><i class="bi bi-trash"></i></button>
                    </td>
                  </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </div>
        <div class="progress" style="height: 3px;">
          <div class="progress-bar bg-primary" id="progressBar" role="progressbar" style="width: 0%"></div>
        </div>
      </div>
    </div>
    {% include 'includes/modal.html' %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script src="{{ url_for('static', filename='js/function.js') }}"></script>
  </body>
</html>
